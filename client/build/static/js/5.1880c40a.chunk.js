(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[5],{723:function(e,a,t){"use strict";function n(e){if(!e.props)return"0h:0m:0s";var a=parseInt(e.props,10),t=Math.floor(a/3600),n=Math.floor((a-3600*t)/60);return a=a-3600*t-60*n,t<10&&(t="0"+t),n<10&&(n="0"+n),a<10&&(a="0"+a),"".concat(t,"h:").concat(n,"m:").concat(a,"s")}t.d(a,"a",(function(){return n}))},733:function(e,a,t){},734:function(e,a,t){e.exports=t.p+"static/media/skayp-call.8a6a4544.mp3"},735:function(e,a,t){e.exports=t.p+"static/media/toot.1e3e7b81.mp3"},736:function(e,a,t){e.exports={title_callOperator:"CallPage_title_callOperator__18-i_",title_callOperator_er:"CallPage_title_callOperator_er__RKVLW",container:"CallPage_container__1G0xH",video_row:"CallPage_video_row__1vLCN",video:"CallPage_video__3juoL",video_player:"CallPage_video_player__3DBl3",user_name:"CallPage_user_name__1Uepa",HangUp_div:"CallPage_HangUp_div__ADxpS",operatot_video_row:"CallPage_operatot_video_row__3IvV6",call_btn_h:"CallPage_call_btn_h__3MXcn",callBtn:"CallPage_callBtn__BGPkZ",btn_call_text:"CallPage_btn_call_text__1rozj",btn_call_name:"CallPage_btn_call_name__G3Sip",btn_call:"CallPage_btn_call__3Dkf7",hoverWave:"CallPage_hoverWave__3WUbS",wraper_callBtn:"CallPage_wraper_callBtn__3ZZGF",video_player_operator:"CallPage_video_player_operator__1TGTF",video_operator:"CallPage_video_operator__3dOx8",video_player_user:"CallPage_video_player_user__2EAqg",video_player_little:"CallPage_video_player_little__1MMT5",modal_container:"CallPage_modal_container__3oGiJ",is_open:"CallPage_is_open__2nlXm",modal_content:"CallPage_modal_content__2f-e4",close:"CallPage_close__3T7xI",btn_call__ico:"CallPage_btn_call__ico__3nmG6","btn-call__ico":"CallPage_btn-call__ico__2M6LE",shake:"CallPage_shake__R67z9"}},747:function(e,a){},749:function(e,a){},759:function(e,a,t){"use strict";t.r(a);var n=t(121),o=t(12),r=t.n(o),c=t(10),l=t(0),i=t.n(l),s=t(30),u=t(708),m=t(17),d=(t(733),function(){var e=Object(l.useContext)(s.a),a=Object(l.useState)(0),t=Object(c.a)(a,2),n=t[0],o=t[1],d=Object(l.useState)(""),_=Object(c.a)(d,2),p=_[0],f=_[1],g=Object(l.useState)(!0),v=Object(c.a)(g,2),b=v[0],h=v[1];Object(l.useEffect)((function(){u.a.get("/api/rating/latest",{headers:{Authorization:"Bearer ".concat(e.token)}}).then((function(e){h(e.data)})).catch((function(e){console.log(e)}))}),[]);var O=function(e){o(parseInt(e.target.value))};return b?"":i.a.createElement("div",{className:"rating_container"},i.a.createElement("div",{className:"container d-flex justify-content-center mt-5"},i.a.createElement("div",{className:" text-center"},i.a.createElement("div",{className:"bg-success text-white rounded"},i.a.createElement("h6",{className:"mb-0 pt-5 P-3"},"\u041d\u0430\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043f\u043e\u043d\u044f\u0442\u043d\u044b\u043c \u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u043c \u0431\u044b\u043b \u043e\u0431\u0449\u0438\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u043a\u043e\u043c\u043c\u0443\u043d\u0438\u043a\u0430\u0446\u0438\u0438 \u0441 \u043f\u0435\u0440\u0435\u0432\u043e\u0434\u0447\u0438\u043a\u043e\u043c?"),i.a.createElement("div",{className:"rating"},i.a.createElement("input",{type:"radio",name:"rating",value:"5",id:"5",checked:5===n,onChange:O}),i.a.createElement("label",{htmlFor:"5"},"\u2606"),i.a.createElement("input",{type:"radio",name:"rating",value:"4",id:"4",checked:4===n,onChange:O}),i.a.createElement("label",{htmlFor:"4"},"\u2606"),i.a.createElement("input",{type:"radio",name:"rating",value:"3",id:"3",checked:3===n,onChange:O}),i.a.createElement("label",{htmlFor:"3"},"\u2606"),i.a.createElement("input",{type:"radio",name:"rating",value:"2",id:"2",checked:2===n,onChange:O}),i.a.createElement("label",{htmlFor:"2"},"\u2606"),i.a.createElement("input",{type:"radio",name:"rating",value:"1",id:"1",checked:1===n,onChange:O}),i.a.createElement("label",{htmlFor:"1"},"\u2606")),i.a.createElement("div",{className:"p-3"},i.a.createElement("input",{type:"text",className:"form-control",placeholder:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u043e\u0442\u0437\u044b\u0432 \u0437\u0434\u0435\u0441\u044c",value:p,onChange:function(e){f(e.target.value)}})),i.a.createElement("div",{className:"buttons px-4 mt-0"},i.a.createElement("button",{className:"btn btn-block rating-submit",style:{backgroundColor:"rgb(47 11 69 / 87%)"},onClick:function(a){var t;return r.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return a.preventDefault(),o.prev=1,o.next=4,r.a.awrap(u.a.post("/api/rating/save",{rating:n,feedback:p,userEmail:e.userEmail},{headers:{Authorization:"Bearer ".concat(e.token)}}));case 4:o.sent,m.b.info("\u043e\u0442\u0437\u044b\u0432 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d",{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),setTimeout((function(){window.location.reload()}),2e3),o.next=13;break;case 9:o.prev=9,o.t0=o.catch(1),t=o.t0.message,m.b.error("".concat(t),{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0});case 13:case"end":return o.stop()}}),null,null,[[1,9]])}},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"))))))}),_=t(734),p=t.n(_),f=t(735),g=t.n(f),v=t(736),b=t.n(v),h=t(737),O=t.n(h),E=t(732),C=(t(58),t(53)),j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=Object(C.a)(),t=a.request,n=a.error,o=a.clearError,i=Object(l.useContext)(s.a),u=Object(l.useState)(!1),d=Object(c.a)(u,2),_=d[0],p=d[1],f=Object(l.useState)(!0),g=Object(c.a)(f,2),v=g[0],b=g[1],h=Object(l.useState)(e),O=Object(c.a)(h,2),E=O[0],j=O[1];Object(l.useEffect)((function(){var e=null;return _&&!1===v?e=setInterval((function(){j((function(e){return e+1}))}),1e3):clearInterval(e),function(){clearInterval(e)}}),[_,v]),Object(l.useEffect)((function(){n&&m.b.error("".concat(n),{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),o()}),[n,o]);var w=function(){p(!0),b(!1)},N=function(e,a){return r.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return b(!v),n.prev=1,n.next=4,r.a.awrap(t("/api/time/save","POST",{duration:E,videoName:e,callFrom:a},{Authorization:"Bearer ".concat(i.token)}));case 4:n.next=9;break;case 6:n.prev=6,n.t0=n.catch(1),console.log(n.t0);case 9:case"end":return n.stop()}}),null,null,[[1,6]])};return{handleStart:w,handlePauseResume:N,time:E}},w=t(723);var N=E.a.connect("".concat("http://localhost:5000/"),{reconnection:!1});a.default=function(e){var a=j(0),t=a.handleStart,o=a.handlePauseResume,s=a.time,u=JSON.parse(localStorage.getItem("userData")),_=u.username,f=u.usersurname,v=u.userEmail,h=Object(l.useState)(!1),E=Object(c.a)(h,2),C=E[0],y=E[1],k=Object(l.useState)(!1),P=Object(c.a)(k,2),S=P[0],x=P[1],T=Object(l.useState)(),M=Object(c.a)(T,2),B=M[0],R=M[1],H=Object(l.useState)({}),U=Object(c.a)(H,2),D=U[0],I=U[1],A=Object(l.useState)([]),F=Object(c.a)(A,2),G=F[0],L=F[1],W=Object(l.useState)(),z=Object(c.a)(W,2),J=z[0],V=z[1],Z=Object(l.useRef)(),q=Object(l.useRef)(),X=Object(l.useRef)(),K=Object(l.useRef)(N),Q=Object(l.useState)(null),Y=Object(c.a)(Q,2),$=Y[0],ee=Y[1],ae=Object(l.useState)(null),te=Object(c.a)(ae,2),ne=te[0],oe=te[1],re=Object(l.useState)(!1),ce=Object(c.a)(re,2),le=(ce[0],ce[1]),ie=null,se=[],ue=u.userId,me=Object(l.useRef)("".concat(_,"_").concat(ue,"_").concat((new Date).toLocaleDateString().replace(/\./g,""),"_").concat((new Date).toLocaleTimeString().replace(/\:/g,""),"_").concat(function(e){for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=e;n>0;--n)t+=a[Math.round(Math.random()*(a.length-1))];return t}(8))),de=new Audio(p.a),_e=new Audio(g.a),pe=Object(l.useState)({screen1:!0,screen2:!1}),fe=Object(c.a)(pe,2),ge=fe[0],ve=fe[1],be=Object(l.useState)(!1),he=Object(c.a)(be,2),Oe=he[0],Ee=he[1],Ce=Object(l.useState)(!1),je=Object(c.a)(Ce,2),we=je[0],Ne=je[1],ye=Object(l.useState)(100),ke=Object(c.a)(ye,2),Pe=ke[0],Se=ke[1];function xe(){o(me.current,D.from),le(!1),K.current.emit("screenData:end",me.current),ie=null,se=[]}Object(l.useEffect)((function(){var a=function(){var e;return r.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,r.a.awrap(navigator.mediaDevices.getUserMedia({video:!0,audio:!0}));case 3:e=a.sent,R(e),Z.current.srcObject=e,a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.log("An error occurred: "+a.t0);case 11:case"end":return a.stop()}}),null,null,[[0,8]])};if(e.props){var t="room"+e.props.operator;K.current.emit("user:connect",me.current),a(),navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(e){return ee(e)})).catch((function(e){return console.log("An error occurred while getting screen media: "+e)})),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){return oe(e)})).catch((function(e){return console.log("An error occurred while getting audio media: "+e)})),N.emit("createRoom",v,t,ue),N.on("callUser",(function(e){var a=e.from,t=e.name,n=e.signal,o=e.surname;I({isReceivingCall:!0,from:a,name:t,signal:n,surname:o})}))}else N.on("answerCall",(function(e){var a=e.from,t=e.name,n=e.signal,o=e.surname;console.log("answer"),I({isReceivingCall:!0,from:a,name:t,signal:n,surname:o})})),N.emit("createRoom",v),N.on("online_room",(function(e){L(e)})),a();N.on("update",(function(e){return console.log(e)})),N.on("connect_error",(function(e){console.log(e),setTimeout((function(){window.location.reload()}),500)})),N.on("disconnect",(function(){window.location.reload()})),N.on("callEndeMessage",(function(e){m.b.error("\u0441\u0432\u044f\u0437\u044c \u043f\u0440\u0435\u0440\u0432\u0430\u043d\u0430 callEndeMessage",{position:"top-right",autoClose:1e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),setTimeout((function(){window.location.reload()}),1e3)})),N.on("callUser",(function(e){var a=e.from,t=e.name,n=e.signal,o=e.surname;console.log("operator"),I({isReceivingCall:!0,from:a,name:t,signal:n,surname:o})}));return function(){B&&B.getTracks().forEach((function(e){e.stop()})),$&&$.getTracks().forEach((function(e){e.stop()})),ne&&ne.getTracks().forEach((function(e){e.stop()})),N.off("update"),N.off("connect_error"),N.off("disconnect"),N.off("callEndeMessage"),N.off("callUser")}}),[e.props,v]),Object(l.useEffect)((function(){var e=Math.floor(Math.random()*G.length);if(G[e]){var a=G[e];V(a.operator),console.log(G)}}),[G]);var Te=function(){!function(){var e;$&&ne&&!ie&&(le(!0),t(),e="unavailable"===ne?$:new MediaStream([].concat(Object(n.a)($.getVideoTracks()),Object(n.a)(ne.getAudioTracks()))),(ie=new MediaRecorder(e)).ondataavailable=function(e){var a=e.data;se.push(a),K.current.emit("screenData:start",{username:me.current,data:a})},ie.onstop=xe,ie.start(150))}(),de.loop=!1,de.pause(),y(!0);var a=new O.a({initiator:!1,trickle:!1,stream:B});a.on("signal",(function(a){N.emit("answerCall",{signal:a,to:D.from,room:"room"+e.props.operator})})),a.on("stream",(function(e){q.current.srcObject=e})),a.on("error",(function(e){console.log(e),(e="RTCError: User-Initiated Abort, reason=Close called")&&(m.b.error("\u0441\u0432\u044f\u0437\u044c \u043f\u0440\u0435\u0440\u0432\u0430\u043d\u0430 \u2116".concat(e.message),{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),xe(),N.emit("callEnde",D.from),X.current.destroy(),setTimeout((function(){window.location.reload()}),500))})),a.signal(D.signal),X.current=a};window.onerror=function(e,a,t,n,o){return"Uncaught Error: Connection failed."===e&&(xe(),m.b.error("Connection failed",{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})),!1};var Me=function(){window.scrollTo(0,document.documentElement.scrollHeight),xe(),console.log(D.from),N.emit("callEnde",D.from),X.current.destroy(),x(!0),setTimeout((function(){window.location.reload()}),500)};Object(l.useEffect)((function(){return window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),D.isReceivingCall&&!C?(de.loop=!0,de.play()):(de.loop=!1,de.pause()),function(){de.loop=!1,setTimeout((function(){de.pause()}),500)}}),[D,C]),Object(l.useEffect)((function(){576>=window.innerWidth&&Ee(!0)}),[]);var Be=function(){ve({screen1:!ge.screen1,screen2:ge.screen1})};Object(l.useEffect)((function(){if(Pe){var e=setInterval((function(){Se(Pe-1)}),1e3);return function(){return clearInterval(e)}}}),[Pe]);return Object(l.useEffect)((function(){void 0!==Z.current&&Z.current.play(),void 0!==q.current&&q.current.play()}),[we]),i.a.createElement("div",{className:"background_IMG"},e.props?"":i.a.createElement(d,null),i.a.createElement("div",{className:"container",onClick:function(){Se(8)}},i.a.createElement(m.a,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0}),i.a.createElement("h1",{className:b.a.title_callOperator},"\u041f\u0435\u0440\u0435\u0432\u043e\u0434\u0447\u0438\u043a \u0436\u0435\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u044f\u0437\u044b\u043a\u0430"),i.a.createElement("div",{className:"Operators-row"},Oe?i.a.createElement("div",{className:b.a.modal_container+" "+"".concat(we&&b.a.is_open)},i.a.createElement("div",{className:b.a.modal_content},i.a.createElement("div",{className:b.a.video_operator+" "+b.a.video+" "+"".concat(ge.screen2&&b.a.video_player_little),onClick:function(){Be()}},i.a.createElement("video",{ref:Z,muted:!0,autoPlay:!0,className:b.a.video_player_user+" "+b.a.video_player})),C&&!S&&i.a.createElement("div",{className:b.a.video+" "+"".concat(ge.screen1&&b.a.video_player_little),onClick:function(){Be()}},i.a.createElement("video",{ref:q,autoPlay:!0,className:b.a.video_player_operator+" "+b.a.video_player}),i.a.createElement("h6",{className:b.a.user_name},D.name," ",D.surname," "),i.a.createElement("h6",{className:b.a.user_name},D.email," ")),Pe&&i.a.createElement("div",{className:b.a.HangUp_div},i.a.createElement("button",{type:"button",className:b.a.call_btn_h,onClick:Me})))):i.a.createElement("div",{className:b.a.container},i.a.createElement("div",{className:b.a.operatot_video_row},i.a.createElement("div",{className:"col-6 p-2"},i.a.createElement("video",{playsInline:!0,ref:Z,muted:!0,autoPlay:!0,className:b.a.video_player_user+" "+b.a.video_player})),C&&!S&&i.a.createElement("div",{className:"col-6 p-2"},i.a.createElement("video",{ref:q,autoPlay:!0,className:b.a.video_player_operator+" "+b.a.video_player}),i.a.createElement("h6",{className:b.a.user_name},D.name," ",D.surname," "))))),D.isReceivingCall&&!C&&i.a.createElement("div",{className:b.a.btn_call_text},i.a.createElement("p",{className:b.a.btn_call_name},D.name),i.a.createElement("button",{className:b.a.btn_call,onClick:function(){Te()}},i.a.createElement("div",{className:b.a.btn_call__ico},i.a.createElement("i",{className:"fas fa-phone-alt"})))),i.a.createElement("div",{className:b.a.wraper_callBtn},C&&!S?i.a.createElement("div",{className:b.a.HangUp_div},i.a.createElement("button",{type:"button",className:b.a.call_btn_h,onClick:Me})):G.length?i.a.createElement("div",{className:b.a.HangUp_div},i.a.createElement("button",{type:"button",className:b.a.callBtn,onClick:function(){!function(e){_e.loop=!0,_e.play();var a=new O.a({initiator:!0,trickle:!1,stream:B});a.on("error",(function(e){console.log(e)})),a.on("signal",(function(a){N.emit("callUser",{userToCall:e,signalData:a,from:v,name:_,surname:f})})),a.on("stream",(function(e){_e.loop=!1,_e.pause(),q.current.srcObject=e})),N.on("callAccepted",(function(e){y(!0),console.log(e),a.signal(e)})),X.current=a}(J),y(!0),576>=window.innerWidth&&Ne(!0)}})):e.props?"":i.a.createElement("div",{className:b.a.HangUp_div},i.a.createElement("div",{className:"row"},i.a.createElement("h4",{className:b.a.title_callOperator_er},"\u043f\u0440\u043e\u0441\u0438\u043c \u043f\u043e\u0434\u043e\u0436\u0434\u0430\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043c\u0438\u043d\u0443\u0442 \u0432\u0441\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b"),i.a.createElement("h5",{className:b.a.title_callOperator_er},"\u043a\u043e\u0433\u0434\u0430 \u043f\u043e\u044f\u0432\u0438\u0442\u0441\u044f \u0437\u0435\u043b\u0435\u043d\u0430\u044f \u043a\u043d\u043e\u043f\u043a\u0430 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u0435\u0433\u043e \u0434\u043b\u044f \u043e\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043b\u0435\u043d\u0438\u044f \u0432\u0438\u0434\u0435\u043e\u0437\u0432\u043e\u043d\u043a\u0430")))),i.a.createElement("div",{className:"text-end text-danger"},i.a.createElement(w.a,{props:s}))))}}}]);
//# sourceMappingURL=5.1880c40a.chunk.js.map